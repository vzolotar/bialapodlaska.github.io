Date.now||(Date.now=function(){return(new Date).getTime()});
var ZoomImage=function(m,a){var b=this;this.id=m;this.sprite=new PIXI.Sprite(a);this.sprite.anchor.x=0;this.totalTicks=this.ticksLeft=this.oy=this.ox=this.sprite.anchor.y=0;this.values={x:0,y:0,scaleX:1,scaleY:1,alpha:0};this.targetValues={x:0,y:0,scaleX:1,scaleY:1,alpha:1};this.animation=function(a,d,e,f,g){b.targetValues.x=a;b.targetValues.y=d;b.targetValues.scaleX=e;b.targetValues.scaleY=f;b.ticksLeft=b.totalTicks=g};this.tick=function(a){0<b.ticksLeft&&b.ticksLeft--};this.easeOutQuad=function(a,
b,e,f){return-e*(a/=f)*(a-2)+b};this.render=function(a,d){if(0<b.ticksLeft){var e=b.totalTicks-b.ticksLeft+d,f=b.targetValues.y-b.values.y,g=b.targetValues.scaleX-b.values.scaleX,h=b.targetValues.scaleY-b.values.scaleY,p=b.easeOutQuad(e,b.values.x,b.targetValues.x-b.values.x,b.totalTicks),f=b.easeOutQuad(e,b.values.y,f,b.totalTicks),g=b.easeOutQuad(e,b.values.scaleX,g,b.totalTicks),h=b.easeOutQuad(e,b.values.scaleY,h,b.totalTicks),e=b.easeOutQuad(e,b.values.alpha,b.targetValues.alpha,b.totalTicks);
b.sprite.position=new PIXI.Point(p,f);b.sprite.scale.x=g;b.sprite.scale.y=h;b.sprite.alpha=e}}},MrBurn5=function(m){var a=this;this.images=[];this.viewedList=[];this.sprites=[];this.stage=new PIXI.Stage(0);-1!=window.location.href.indexOf("file://")?this.renderer=new PIXI.CanvasRenderer($(window).width(),$(window).height()):this.renderer=PIXI.autoDetectRenderer($(window).width(),$(window).height());this.currentImage=0;this.startTime=-1;this.imageDelay=this.lastTime=this.timeTick=this.timeAlpha=this.unprocessedTime=
0;this.delay=-1;this.isInitialPause=!Settings.autoStart;this.cycles=0;this.waiting=!0;this.mouseActive=this.paused=!1;this.mouseInactivity=0;this.introImage=null;this.ticksPerSecond=25;this.bkgColor=parseInt("0x"+Settings.bkgColor.substring(1),16);this.startButton=function(b){if(null!=a.introImage){a.introImage=null;for(b=a.stage.children.length-1;0<=b;b--)a.stage.removeChild(a.stage.children[b]);setTimeout(function(){$("#overlay").remove();$("#startbtn").remove();a.startShow();a.nextImage()},100)}};
this.startShow=function(){a.mySound&&a.mySound.play().loop();a.shhhItsASecret||$("#nag").delay(3E3).animate({bottom:"15px",opacity:1},"fast");a.currentImage=0;a.isInitialPause=!1};this.delayedResize=function(){for(var b in a.sprites)a.sprites[b].ticksLeft=-1;for(;0<a.viewedList.length;)b=a.viewedList.splice(0,1),a.stage.removeChild(b[0].sprite);a.sprites=[];a.nextImage(!0);a.delay=-1};this.updateSize=function(){var b=$(window).width(),c=$(window).height();a.renderer.resize(b,c);a.renderer.render(a.stage);
$("#overlay").css("width",b+"px").css("height",c+"px")};this.leaveFull=function(){document.cancelFullScreen?document.cancelFullScreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitCancelFullScreen&&document.webkitCancelFullScreen();a.hidePanel()};this.goFull=function(){var b=document.body;b.requestFullScreen?b.requestFullScreen():b.mozRequestFullScreen?b.mozRequestFullScreen():b.webkitRequestFullScreen&&b.webkitRequestFullScreen();a.hidePanel()};this.validateFsMode=
function(){var a=document.fullscreenElement||document.mozFullScreenElement||document.webkitFullscreenElement,c=$("div#ctrlbuttons .btnFullscreen");!a&&c.hasClass("fullscreen1")?(c.removeClass("fullscreen1"),c.addClass("fullscreen0")):a&&c.hasClass("fullscreen0")&&(c.removeClass("fullscreen0"),c.addClass("fullscreen1"))};this.onResize=function(){a.updateSize();a.validateFsMode();-1==a.delay&&(a.delay=setTimeout(a.delayedResize,200))};this.tick=function(){var b=a.timeTick,c;for(c in a.sprites)a.sprites[c].tick(b),
0==a.sprites[c].ticksLeft&&(0<a.imageDelay?a.imageDelay--:a.waiting||a.paused||(a.sprites[c].ticksLeft=-1,a.nextImage()))};this.render=function(){var b=a.timeTick,c=a.timeAlpha,d;for(d in a.sprites)a.sprites[d].render(b,c)};this.update=function(){requestAnimFrame(a.update);var b=1E3/a.ticksPerSecond,c=Date.now();0>a.startTime&&(a.startTime=c,a.unprocessedTime=b);var d=c-a.startTime,e=d-a.lastTime;a.lastTime=d;a.unprocessedTime+=e;if(a.unprocessedTime>=b){c=100+c;do a.tick(),++a.timeTick,a.unprocessedTime-=
b;while(a.unprocessedTime>=b&&Date.now()<c)}a.timeAlpha=a.unprocessedTime/b;a.render();a.renderer.render(a.stage)};this.preload=function(b,c,d){for(var e=[],f=b;f<b+Math.min(c,a.images.length);++f)e.push(a.images[f].url);b=new PIXI.AssetLoader(e);b.onComplete=function(){a.waiting=!1;d&&d()};b.load()};this.closestFill=function(a,c,d,e){a=0|c*(d/a);a<e&&(d=0|d*(e/a),a=e);return[d,a]};this.addImage=function(b){var c=PIXI.Texture.fromImage(a.images[b].url);outTx=c;if(c.height>c.width){var d=Math.max(c.width,
c.height),e=new PIXI.Sprite(c),f=new PIXI.RenderTexture(1.5*d,d),g=new PIXI.Graphics;g.beginFill(a.bkgColor,1);g.moveTo(0,0);g.lineTo(f.width,0);g.lineTo(f.width,f.height);g.lineTo(0,f.height);g.endFill();e.position=new PIXI.Point(Math.max(0,1.5*d-c.width)/2,0);c=new PIXI.DisplayObjectContainer;c.addChild(g);c.addChild(e);f.render(c);outTx=f}b=new ZoomImage(b,outTx);a.sprites.push(b);a.stage.addChild(b.sprite);var f=$(window).width(),g=$(window).height(),d=b.sprite.width,h=b.sprite.height,e=1-Math.min(0.99,
Settings.zoomDrama/1E3),c=a.closestFill(d,h,f,g),f=(f-c[0])/2,g=(g-c[1])/2,d=c[0]/d,h=c[1]/h,p=d,m=h,l=f,k=g,n=c[0],l=c[1],q=n*e,k=l*e,r=c[0]/q,c=c[1]/k,n=-Math.random()*Math.abs(n-q),k=-Math.random()*Math.abs(l-k);Math.random()>Settings.inOutBias/1E3?(b.values.x=f,b.values.y=g,b.values.scaleX=d,b.values.scaleY=h,l=n+f,k+=g,p=r*d,m=c*h):(b.values.x=n*(1/e),b.values.y=k*(1/e),b.values.scaleX=r*d,b.values.scaleY=c*h,l=f,k=g);b.animation(l,k,p,m,Settings.appearTime/a.ticksPerSecond);return b};this.nextImage=
function(b){if(a.isInitialPause){b=PIXI.Texture.fromImage(a.images[0].url);b=new ZoomImage(1,b);var c=$(window).width(),d=$(window).height(),c=a.closestFill(b.sprite.width,b.sprite.height,c,d);b.sprite.scale.x=c[0]/b.sprite.width;b.sprite.scale.y=c[1]/b.sprite.height;a.stage.addChild(b.sprite);a.introImage=b}else{a.imageDelay=Settings.hangTime/a.ticksPerSecond;d=a.currentImage;d=b?a.currentImage-1:a.currentImage++;d==a.images.length&&(d=0,a.currentImage=1);0>d&&(d=0);b=a.addImage(d);var d=a.images.slice(d+
1,Math.min(a.images.length,d+2)),e=[];if(0<d.length){for(c in d)e.push(d[c].url);a.waiting=!0;c=new PIXI.AssetLoader(e);c.onComplete=function(){a.waiting=!1};c.load()}1<a.viewedList.length&&(c=a.viewedList.splice(0,1),a.stage.removeChild(c[0].sprite),a.sprites.splice(0,1));a.viewedList.push(b)}};this.hidePanel=function(){clearTimeout(a.mouseInactivity);$("#ctrlbuttons").animate({right:"-185px",opacity:0},333);a.mouseActive=!1};this.mouseActivity=function(){a.mouseActive||(a.mouseActive=!0,clearTimeout(a.mouseInactivity),
$("#ctrlbuttons").animate({right:"15px",opacity:1},100),a.mouseInactivity=setTimeout(a.hidePanel,1500))};this.initCtrlPanel=function(){function b(a,b,e){if(a.hasClass(b))return a.removeClass(b).addClass(e),0;a.removeClass(e).addClass(b);return 1}Settings.hideControlPanel&&0==Settings.musicUrl.length||($("canvas").mousemove(function(){a.mouseActivity()}).bind("touchstart",function(){a.mouseActivity()}),$("#ctrlbuttons").mouseover(function(){a.mouseActive=!0;clearTimeout(a.mouseInactivity)}),$("#ctrlbuttons").mouseout(function(){a.mouseActive=
!1;clearTimeout(a.mouseInactivity);a.mouseInactivity=setTimeout(a.hidePanel,500)}),$("div#ctrlbuttons .btnFullscreen").click(function(){0==b($(this),"fullscreen0","fullscreen1")?a.goFull():a.leaveFull()}),$("div#ctrlbuttons .btnPlay").click(function(){a.paused=0===b($(this),"play0","play1")}),$("div#ctrlbuttons .btnMusic").click(function(){var c=b($(this),"music0","music1");a.mySound&&(0==c?a.mySound.pause():a.mySound.play())}))};this.initPixi=function(){a.updateSize();document.body.appendChild(a.renderer.view);
requestAnimFrame(a.update);a.preload(a.currentImage,3,function(){Settings.autoStart&&a.startShow();$(window).resize(a.onResize);a.delayedResize();a.currentImage=1});a.initCtrlPanel()};this.initViaInlineJson=function(){for(var b in Images)a.images.push({title:Images[b].title,description:Images[b].description,url:Images[b].slideName,width:Images[b].width,height:Images[b].height});a.initHtml();a.initPixi()};this.initViaXml=function(){$.fn.filterNode=function(a){return this.find("*").filter(function(){return this.nodeName===
a})};$.get("album.xml",function(b){albumName=$(b).find("channel title").first().text();albumDescription=$(b).find("channel description").first().text();$(b).find("item").each(function(){var b=$(this).filterNode("media:content");$(this).filterNode("media:thumbnail");var d=$(this).filterNode("media:description"),e={title:$(this).find("title").text(),description:d.text(),url:b.attr("url"),width:b.attr("width"),height:b.attr("height"),exif:{}};(b=$(this).filterNode("jalbum:exif"))&&0<b.length&&$.each(b[0].attributes,
function(a,b){e.exif[b.name]=b.value});a.images.push(e)});a.initHtml();a.initPixi()},"xml").error(function(){alert("TODO: Make nicer error message ...")})};this.initHtml=function(){if(0<Settings.musicUrl.length){var b=Settings.musicUrl.substring(0,Settings.musicUrl.lastIndexOf("."));a.mySound=new buzz.sound(b,{formats:["mp3"]})}a.shhhItsASecret=CryptoJS.enc.Hex.stringify(CryptoJS.MD5(Settings.registeredTo+"partofit"))===Settings.registrationKey;if(!Settings.autoStart){$(document.body).append($("<div>",
{id:"overlay"}));var b=$("<div>",{id:"startbtn"}),c=$("<a>");c.append($("<img>",{src:"res/i/startBtn.png"}));b.append(c);$(document.body).append(b);c.click(a.startButton)}}};$(document).ready(function(){(new MrBurn5).initViaInlineJson()});